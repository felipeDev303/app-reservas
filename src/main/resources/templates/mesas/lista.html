<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Listado de Mesas</title>

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css"
    />
  </head>
  <body class="bg-light">
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
      <div class="container-fluid px-4">
        <span class="navbar-brand mb-0 h1">
          <i class="bi bi-table me-2"></i>Listado de Mesas
        </span>
        <a href="/" class="btn btn-light">
          <i class="bi bi-house me-2"></i>Volver al Inicio
        </a>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container my-4">
      <!-- Filter Bar -->
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <div class="row g-3 align-items-end">
            <div class="col-md-4">
              <label for="filtroTipo" class="form-label fw-semibold"
                >Tipo de Mesa</label
              >
              <select id="filtroTipo" class="form-select">
                <option value="">Todas</option>
                <option value="INTERIOR">Interior</option>
                <option value="EXTERIOR">Exterior</option>
                <option value="TERRAZA">Terraza</option>
                <option value="VIP">VIP</option>
                <option value="BARRA">Barra</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="filtroEstado" class="form-label fw-semibold"
                >Estado</label
              >
              <select id="filtroEstado" class="form-select">
                <option value="">Todos</option>
                <option value="DISPONIBLE">Disponible</option>
                <option value="OCUPADA">Ocupada</option>
                <option value="RESERVADA">Reservada</option>
                <option value="MANTENIMIENTO">Mantenimiento</option>
              </select>
            </div>
            <div class="col-md-4">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="filtroActivas"
                  checked
                />
                <label class="form-check-label fw-semibold" for="filtroActivas">
                  Solo mesas activas
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div id="loading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-3 text-muted">Cargando mesas...</p>
      </div>

      <!-- Mesas Grid -->
      <div
        id="mesasContainer"
        class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 d-none"
      ></div>

      <!-- Empty State -->
      <div id="emptyState" class="text-center py-5 d-none">
        <i class="bi bi-inbox display-1 text-muted"></i>
        <h2 class="mt-3 text-muted">No hay mesas para mostrar</h2>
        <p class="text-muted">Ajusta los filtros para ver m√°s resultados</p>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let todasLasMesas = [];

      async function cargarMesas() {
        try {
          const response = await fetch("/api/mesas");
          todasLasMesas = await response.json();
          mostrarMesas(todasLasMesas);
          document.getElementById("loading").classList.add("d-none");
        } catch (error) {
          console.error("Error cargando mesas:", error);
          document.getElementById("loading").innerHTML = `
            <div class="alert alert-danger" role="alert">
              <i class="bi bi-exclamation-triangle me-2"></i>Error al cargar las mesas
            </div>
          `;
        }
      }

      function mostrarMesas(mesas) {
        const container = document.getElementById("mesasContainer");
        const emptyState = document.getElementById("emptyState");

        if (mesas.length === 0) {
          container.classList.add("d-none");
          emptyState.classList.remove("d-none");
          return;
        }

        emptyState.classList.add("d-none");
        container.classList.remove("d-none");
        container.innerHTML = mesas
          .map((mesa) => {
            const borderClass = {
              DISPONIBLE: "border-success",
              OCUPADA: "border-danger",
              RESERVADA: "border-warning",
              MANTENIMIENTO: "border-secondary",
            }[mesa.estado];

            const badgeClass = {
              DISPONIBLE: "bg-success",
              OCUPADA: "bg-danger",
              RESERVADA: "bg-warning text-dark",
              MANTENIMIENTO: "bg-secondary",
            }[mesa.estado];

            const iconEstado = {
              DISPONIBLE: "check-circle",
              OCUPADA: "x-circle",
              RESERVADA: "calendar-check",
              MANTENIMIENTO: "tools",
            }[mesa.estado];

            return `
              <div class="col">
                <div class="card h-100 shadow-sm border-start border-4 ${borderClass}">
                  <div class="card-body">
                    <h3 class="card-title fw-bold">
                      <i class="bi bi-table me-2"></i>Mesa ${mesa.numero}
                    </h3>
                    <span class="badge bg-primary mb-3">${formatearTipo(
                      mesa.tipo
                    )}</span>
                    
                    <p class="mb-2">
                      <i class="bi bi-people me-2"></i>
                      Capacidad: <strong>${mesa.capacidadMinima} - ${
              mesa.capacidadMaxima
            }</strong> personas
                    </p>
                    
                    ${
                      mesa.descripcion
                        ? `
                      <p class="text-muted small mb-3">
                        <i class="bi bi-info-circle me-2"></i>${mesa.descripcion}
                      </p>
                    `
                        : ""
                    }
                    
                    <span class="badge ${badgeClass}">
                      <i class="bi bi-${iconEstado} me-1"></i>${formatearEstado(
              mesa.estado
            )}
                    </span>
                    
                    ${
                      !mesa.activa
                        ? `
                      <div class="alert alert-danger mt-3 py-2 mb-0" role="alert">
                        <i class="bi bi-exclamation-triangle me-2"></i>Inactiva
                      </div>
                    `
                        : ""
                    }
                  </div>
                </div>
              </div>
            `;
          })
          .join("");
      }

      function formatearTipo(tipo) {
        const tipos = {
          INTERIOR: "Interior",
          EXTERIOR: "Exterior",
          TERRAZA: "Terraza",
          VIP: "VIP",
          BARRA: "Barra",
        };
        return tipos[tipo] || tipo;
      }

      function formatearEstado(estado) {
        const estados = {
          DISPONIBLE: "Disponible",
          OCUPADA: "Ocupada",
          RESERVADA: "Reservada",
          MANTENIMIENTO: "Mantenimiento",
        };
        return estados[estado] || estado;
      }

      function aplicarFiltros() {
        const filtroTipo = document.getElementById("filtroTipo").value;
        const filtroEstado = document.getElementById("filtroEstado").value;
        const soloActivas = document.getElementById("filtroActivas").checked;

        let mesasFiltradas = todasLasMesas.filter((mesa) => {
          if (filtroTipo && mesa.tipo !== filtroTipo) return false;
          if (filtroEstado && mesa.estado !== filtroEstado) return false;
          if (soloActivas && !mesa.activa) return false;
          return true;
        });

        mostrarMesas(mesasFiltradas);
      }

      document
        .getElementById("filtroTipo")
        .addEventListener("change", aplicarFiltros);
      document
        .getElementById("filtroEstado")
        .addEventListener("change", aplicarFiltros);
      document
        .getElementById("filtroActivas")
        .addEventListener("change", aplicarFiltros);

      cargarMesas();
    </script>
  </body>
</html>
